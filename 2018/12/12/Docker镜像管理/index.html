<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  

  
  <title>Docker镜像管理 | Hexo</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="一.关于Docker镜像 Docker镜像含有启动容器所需要的文件系统及其内容 ,因此 其用于创建并启动docke镜像.  采用分层构建机制    最底层为bootfs ,向上为rootfs    bootfs:用于系统引导的文件系统,包括bootloader和kernel ,容器启动完成后会被卸载以节约内存资源    rootfs:位于bootfs之上,变现为docker容器的跟文件系统">
<meta property="og:type" content="article">
<meta property="og:title" content="Docker镜像管理">
<meta property="og:url" content="http://example.com/2018/12/12/Docker%E9%95%9C%E5%83%8F%E7%AE%A1%E7%90%86/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:description" content="一.关于Docker镜像 Docker镜像含有启动容器所需要的文件系统及其内容 ,因此 其用于创建并启动docke镜像.  采用分层构建机制    最底层为bootfs ,向上为rootfs    bootfs:用于系统引导的文件系统,包括bootloader和kernel ,容器启动完成后会被卸载以节约内存资源    rootfs:位于bootfs之上,变现为docker容器的跟文件系统">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://i.imgur.com/EUUWb3h.png">
<meta property="og:image" content="https://i.imgur.com/lZAwKPC.png">
<meta property="og:image" content="https://i.imgur.com/uuo6iL1.png">
<meta property="og:image" content="https://i.imgur.com/VgVbXMb.png">
<meta property="og:image" content="https://i.imgur.com/aAjpQDV.png">
<meta property="og:image" content="https://i.imgur.com/Ul4GK6Q.png">
<meta property="og:image" content="https://i.imgur.com/1ZPb2zs.png">
<meta property="og:image" content="https://i.imgur.com/nIbfC1O.png">
<meta property="og:image" content="https://i.imgur.com/b63MDzu.png">
<meta property="og:image" content="https://i.imgur.com/8alh2dC.png">
<meta property="og:image" content="https://i.imgur.com/lbdBFpk.png">
<meta property="article:published_time" content="2018-12-12T11:32:57.000Z">
<meta property="article:modified_time" content="2018-12-20T05:36:12.242Z">
<meta property="article:author" content="John Doe">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://i.imgur.com/EUUWb3h.png">
  
    <link rel="alternate" href="/atom.xml" title="Hexo" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  
<link rel="stylesheet" href="/css/style.css">

<meta name="generator" content="Hexo 5.2.0"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Hexo</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://example.com"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main"><article id="post-Docker镜像管理" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/12/12/Docker%E9%95%9C%E5%83%8F%E7%AE%A1%E7%90%86/" class="article-date">
  <time datetime="2018-12-12T11:32:57.000Z" itemprop="datePublished">2018-12-12</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Docker/">Docker</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      Docker镜像管理
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="一-关于Docker镜像"><a href="#一-关于Docker镜像" class="headerlink" title="一.关于Docker镜像"></a>一.关于Docker镜像</h1><ul>
<li><p>Docker镜像含有启动容器所需要的文件系统及其内容 ,因此 其用于创建并启动docke镜像.</p>
<ul>
<li><p>采用分层构建机制    最底层为bootfs ,向上为rootfs  </p>
<ul>
<li><p>bootfs:用于系统引导的文件系统,包括bootloader和kernel ,容器启动完成后会被卸载以节约内存资源  </p>
</li>
<li><p>rootfs:位于bootfs之上,变现为docker容器的跟文件系统  </p>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<pre><code>      - 传统模式中,系统启动之时,内核挂载tootfs时会首先将其挂载为&quot;只读&quot; 模式,完整性自检完成后将其重新挂载为读写模式  

      - docker中,rootfs由内核挂载为&quot;只读&quot;模式,而后通过&quot;联合挂载&quot;技术额外挂载一个&quot;可写&quot;层;  </code></pre>
<p><img src="https://i.imgur.com/EUUWb3h.png"></p>
<hr>
<h1 id="二-Docker镜像分层"><a href="#二-Docker镜像分层" class="headerlink" title="二.Docker镜像分层"></a>二.Docker镜像分层</h1><ul>
<li>位于下层的镜像称为父镜像,最底层的称为基础镜像(base image) </li>
<li>最上层为”可读写”层,其下的均为”只读”层  <ul>
<li> 当删除容器时 ,可写层会一起删除<br><img src="https://i.imgur.com/lZAwKPC.png">  </li>
</ul>
</li>
</ul>
<hr>
<h1 id="三-Docker存储"><a href="#三-Docker存储" class="headerlink" title="三.Docker存储"></a>三.Docker存储</h1><ul>
<li>启动容器时,docker daemon会试图从本地获取相关的镜像,本地镜像不存在时,其将从Registry中下载该镜像并保存到本地.</li>
</ul>
<pre><code>Registry没有特别指定 默认为docker hub  ,如果使用别的Registry ,则必须在镜像的访问路径给名服务器地址</code></pre>
<hr>
<h1 id="四-Docker-Hub"><a href="#四-Docker-Hub" class="headerlink" title="四.Docker Hub"></a>四.Docker Hub</h1><p>注册账号:<a target="_blank" rel="noopener" href="https://hub.docker.com/signup">https://hub.docker.com/signup</a>   </p>
<pre><code>获取镜像:
#docker pull &lt;registry&gt;[:&lt;port&gt;]/[&lt;namespace&gt;/]&lt;name&gt;:&lt;tag&gt;
&lt;registry&gt;[:&lt;port&gt;]       哪个仓库服务器加端口  docker hub 可省略
/[&lt;namespace&gt;/]          名称空间 哪个用户的仓库 顶层可省略
&lt;name&gt;:&lt;tag&gt;             仓库名加标签名</code></pre>
<p>其他著名仓库服务器:<a target="_blank" rel="noopener" href="https://quay.io/">https://quay.io/</a><br>例:  </p>
<pre><code>[root@Docker ~]# docker pull quay.io/coreos/flannel:v0.10.0-s390x   //端口默认为443</code></pre>
<p><img src="https://i.imgur.com/uuo6iL1.png">   </p>
<hr>
<h1 id="五-镜像相关操作"><a href="#五-镜像相关操作" class="headerlink" title="五.镜像相关操作"></a>五.镜像相关操作</h1><h2 id="5-1-镜像的生成途径"><a href="#5-1-镜像的生成途径" class="headerlink" title="5.1 镜像的生成途径"></a>5.1 镜像的生成途径</h2><ul>
<li>Dockerfile  </li>
<li>基于容器制作</li>
<li>Docker Hub automater builds  </li>
</ul>
<h2 id="5-2-基于容器做镜像"><a href="#5-2-基于容器做镜像" class="headerlink" title="5.2 基于容器做镜像"></a>5.2 基于容器做镜像</h2><h3 id="1-先启动一个容器-做好修改"><a href="#1-先启动一个容器-做好修改" class="headerlink" title="1.先启动一个容器 做好修改"></a>1.先启动一个容器 做好修改</h3><p>先pull busybox镜像 启动后做一个主页 这样下次启动主页就存在   </p>
<pre><code> [root@liujie ~]# docker run --name web1 -it busybox
 / # mkdir /data/html
 mkdir: can&#39;t create directory &#39;/data/html&#39;: No such file or directory
/ # mkdir -p  /data/html
/ # vi /data/html/index.html
hello  httpd
//此时不能关闭容器 </code></pre>
<h3 id="2-基于容器做镜像"><a href="#2-基于容器做镜像" class="headerlink" title="2.基于容器做镜像"></a>2.基于容器做镜像</h3><p>Usage:    docker commit [OPTIONS] CONTAINER [REPOSITORY[:TAG]]<br>docker commit [OPTIONS] CONTAINER    基于哪个容器做镜像<br>[REPOSITORY[:TAG]]                                    属于哪个仓库拥有什么标签  如果省略则代表本地的裸镜像 不属于任何仓库  </p>
<pre><code>[root@liujie ~]# docker commit -p web1   //-p是暂停  防止保存部分文件 
sha256:b4ecf4975f3b22284c26be372197aa73029d0781acaeb584456fb624fc1fa934 
[root@liujie ~]# docker image ls
REPOSITORY               TAG                 IMAGE ID            CREATED             SIZE
&lt;none&gt;                   &lt;none&gt;              b4ecf4975f3b        12 minutes ago      1.15MB
仓库为空                 标签也为空            id为生成id </code></pre>
<p>为了后续管理 可以为打标签  </p>
<pre><code>[root@liujie ~]# docker tag b4ecf4975f3b 18834478096/httpd:v0.1   //基于id  18834478096为docker hub账号为后续上传
[root@liujie ~]# docker image ls
REPOSITORY               TAG                 IMAGE ID            CREATED             SIZE
18834478096/httpd             v0.1                b4ecf4975f3b        About an hour ago   1.15MB   </code></pre>
<p>删除镜像：  两个标签时可删除  只有一个标签删除会报错  </p>
<pre><code>[root@liujie ~]# docker image rm liujie/httpd:v0.1.1
Untagged: liujie/httpd:v0.1.1   </code></pre>
<h3 id="3-启动做好的镜像"><a href="#3-启动做好的镜像" class="headerlink" title="3. 启动做好的镜像"></a>3. 启动做好的镜像</h3><pre><code>[root@liujie ~]# docker run --name t1 -it 18834478096/httpd:v0.1
/ # cd /
/ # ls
bin   data  dev   etc   home  proc  root  sys   tmp   usr   var
/ #   //之前创建好的data目录存在  </code></pre>
<h2 id="5-3-上传镜像"><a href="#5-3-上传镜像" class="headerlink" title="5.3 上传镜像"></a>5.3 上传镜像</h2><p>放到docker hub上：  </p>
<h3 id="1-注册账号"><a href="#1-注册账号" class="headerlink" title="1.注册账号"></a>1.注册账号</h3><p><a target="_blank" rel="noopener" href="https://hub.docker.com/">https://hub.docker.com/</a>  </p>
<h3 id="2-使用Docker-hub账号在验证本地登录"><a href="#2-使用Docker-hub账号在验证本地登录" class="headerlink" title="2.使用Docker hub账号在验证本地登录"></a>2.使用Docker hub账号在验证本地登录</h3><pre><code>[root@liujie ~]# docker login -u 18834478096
Password:
WARNING! Your password will be stored unencrypted in /root/.docker/config.json.
Configure a credential helper to remove this warning. See
https://docs.docker.com/engine/reference/commandline/login/#credentials-store

Login Succeeded</code></pre>
<h3 id="3-查看本地的镜像"><a href="#3-查看本地的镜像" class="headerlink" title="3. 查看本地的镜像"></a>3. 查看本地的镜像</h3><pre><code>[root@liujie ~]# docker image images
REPOSITORY               TAG                 IMAGE ID            CREATED             SIZE
18834478096/httpd        v0.1                b4ecf4975f3b        3 hours ago         1.15MB</code></pre>
<p>如果REPOITORY的名不是你Docker hub账号和仓库，即Docker ID/仓库名，是上传不成功的   </p>
<h3 id="4-在Docker-Hub上创建仓库"><a href="#4-在Docker-Hub上创建仓库" class="headerlink" title="4.在Docker Hub上创建仓库"></a>4.在Docker Hub上创建仓库</h3><p><img src="https://i.imgur.com/VgVbXMb.png"><br><img src="https://i.imgur.com/aAjpQDV.png"></p>
<h3 id="5-推镜像"><a href="#5-推镜像" class="headerlink" title="5.推镜像"></a>5.推镜像</h3><pre><code>[root@liujie ~]# docker image push 18834478096/httpd:v0.1
The push refers to repository [docker.io/18834478096/httpd]
de66091347b2: Pushed
8a788232037e: Mounted from library/busybox
v0.1: digest: sha256:eccf03eea662b180d52d3c4909bcd82cfc7a7b319c6a4d664643750cdf0544b9 size: 734  </code></pre>
<p><img src="https://i.imgur.com/Ul4GK6Q.png">  </p>
<hr>
<hr>
<hr>
<p>上传阿里镜像仓库  </p>
<p><a target="_blank" rel="noopener" href="https://cr.console.aliyun.com/">https://cr.console.aliyun.com/</a><br><img src="https://i.imgur.com/1ZPb2zs.png"></p>
<p>选择本地仓库 创建镜像仓库<br><img src="https://i.imgur.com/nIbfC1O.png">  </p>
<p>点击管理<br><img src="https://i.imgur.com/b63MDzu.png"><br><img src="https://i.imgur.com/8alh2dC.png">  </p>
<p>1.给镜像打标签 使用阿里云地址   </p>
<pre><code>[root@liujie ~]# docker image images
REPOSITORY               TAG                 IMAGE ID            CREATED             SIZE
18834478096/httpd        v0.1                b4ecf4975f3b        3 hours ago         1.15MB
[root@liujie ~]# docker tag 18834478096/httpd:v0.1 registry.cn-qingdao.aliyuncs.com/18834478096/httpd:v0.1
[root@liujie ~]# docker image ls
REPOSITORY                                           TAG                 IMAGE ID            CREATED             SIZE
18834478096/httpd                                    v0.1                b4ecf4975f3b        3 hours ago         1.15MB
registry.cn-qingdao.aliyuncs.com/18834478096/httpd   v0.1                b4ecf4975f3b        3 hours ago         1.15MB</code></pre>
<p>2.登录阿里云   </p>
<pre><code>[root@liujie ~]# docker logout
Removing login credentials for https://index.docker.io/v1/
[root@liujie ~]# docker login --username=18834478096 registry.cn-qingdao.aliyuncs.com
Password:     //密码为Registry登录密码 
WARNING! Your password will be stored unencrypted in /root/.docker/config.json.
Configure a credential helper to remove this warning. See
https://docs.docker.com/engine/reference/commandline/login/#credentials-store

Login Succeeded  </code></pre>
<p>3.推镜像到阿里云  </p>
<pre><code>[root@liujie ~]# docker push registry.cn-qingdao.aliyuncs.com/18834478096/httpd:v0.1
The push refers to repository [registry.cn-qingdao.aliyuncs.com/18834478096/httpd]
de66091347b2: Pushed
8a788232037e: Pushed
v0.1: digest: sha256:eccf03eea662b180d52d3c4909bcd82cfc7a7b319c6a4d664643750cdf0544b9 size: 734   </code></pre>
<p><img src="https://i.imgur.com/lbdBFpk.png">  </p>
<hr>
<h2 id="5-4-镜像导入导出"><a href="#5-4-镜像导入导出" class="headerlink" title="5.4 镜像导入导出"></a>5.4 镜像导入导出</h2><p>打包镜像   </p>
<pre><code> [root@liujie ~]# docker save -o myfirst.gz 18834478096/httpd:v0.1
 [root@liujie ~]# ll
 total 230540
 -rw-------   1 root root    1386496 Dec 19 23:01 myfirst.gz</code></pre>
<p>发送压缩包到其他docker主机使用  </p>
<pre><code>[root@liujie2 ~]# docker load -i myfirst.gz
[root@liujie2 ~]# docker image ls
REPOSITORY                                           TAG                 IMAGE ID            CREATED             SIZE
18834478096/httpd                                    v0.1                b4ecf4975f3b        4 hours ago         1.15MB</code></pre>
<p>这种方法run之前要先pull镜像  不然run还会从默认地址下镜像</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2018/12/12/Docker%E9%95%9C%E5%83%8F%E7%AE%A1%E7%90%86/" data-id="ckibpb0e600058cj04cdbcnvs" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2018/12/13/Docker%E7%A7%81%E6%9C%89registry%20Harbor/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Newer</strong>
      <div class="article-nav-title">
        
          Docker私有registry Harbor
        
      </div>
    </a>
  
  
    <a href="/2018/12/11/Docker%E5%9F%BA%E7%A1%80%E7%94%A8%E6%B3%95/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">Docker基础用法</div>
    </a>
  
</nav>

  
</article>

</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Categories</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Docker/">Docker</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/LVS/">LVS</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Linux/">Linux</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Mysql/">Mysql</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Nginx/">Nginx</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Zabbix/">Zabbix</a></li></ul>
    </div>
  </div>


  
    

  
    
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/12/">December 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/01/">January 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/12/">December 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/11/">November 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/08/">August 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/05/">May 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/04/">April 2018</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2020/12/02/test/">test</a>
          </li>
        
          <li>
            <a href="/2019/01/03/CloudBoot/">CloudBoot</a>
          </li>
        
          <li>
            <a href="/2019/01/01/LVS%E9%9B%86%E7%BE%A4-NAT%E6%A8%A1%E5%BC%8F/">LVS集群-NAT模式</a>
          </li>
        
          <li>
            <a href="/2018/12/13/Docker%E7%A7%81%E6%9C%89registry%20Harbor/">Docker私有registry Harbor</a>
          </li>
        
          <li>
            <a href="/2018/12/12/Docker%E9%95%9C%E5%83%8F%E7%AE%A1%E7%90%86/">Docker镜像管理</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2020 John Doe<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  
<link rel="stylesheet" href="/fancybox/jquery.fancybox.css">

  
<script src="/fancybox/jquery.fancybox.pack.js"></script>




<script src="/js/script.js"></script>




  </div>
</body>
</html>